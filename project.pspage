["pagename:Ковер","\u003cact9\u003e:\u003c!DOCTYPE html\u003e\n\u003chtml lang\u003d\"ru\"\u003e\n\u003chead\u003e\n    \u003cmeta charset\u003d\"UTF-8\"\u003e\n    \u003cmeta name\u003d\"viewport\" content\u003d\"width\u003ddevice-width, initial-scale\u003d1.0\"\u003e\n    \u003ctitle\u003eCarpetGram | Социальная сеть ковров\u003c/title\u003e\n    \u003clink rel\u003d\"stylesheet\" href\u003d\"style.css\"\u003e\n    \u003clink rel\u003d\"stylesheet\" href\u003d\"https://fonts.googleapis.com/css2?family\u003dMaterial+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0\" /\u003e\n    \u003cscript src\u003d\"https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js\"\u003e\u003c/script\u003e\n    \u003cscript src\u003d\"https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js\"\u003e\u003c/script\u003e\n    \u003cscript src\u003d\"https://www.gstatic.com/firebasejs/8.10.0/firebase-analytics.js\"\u003e\u003c/script\u003e\n\u003cstyle\u003e\n/* --- Общие Стили и Палитра --- */\n:root {\n    --primary-color: #6a11cb; /* Глубокий фиолетовый для градиента */\n    --secondary-color: #2575fc; /* Ярко-синий для градиента */\n    --accent-color: #ff5722; /* Оранжевый для акцентов (лайки) */\n    --background-light: #f4f6f8; /* Светлый фон */\n    --card-background: #ffffff; /* Белый фон карточек */\n    --border-color: #e0e0e0;\n    --gray-area: #f0f0f0; /* Серый цвет для области загрузки */\n    --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.05);\n    --shadow-heavy: 0 8px 24px rgba(0, 0, 0, 0.1);\n}\n\n* {\n    box-sizing: border-box;\n    margin: 0;\n    padding: 0;\n    font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Oxygen-Sans, Ubuntu, Cantarell, \"Helvetica Neue\", sans-serif;\n}\n\nbody {\n    background-color: var(--background-light);\n    padding-bottom: 80px; /* Отступ для главного статус-бара */\n    color: #333;\n    overflow-x: hidden;\n}\n\n/* --- Градиентный Текст --- */\n.logo-text,\n.logo-icon,\n.add-icon {\n    background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));\n    -webkit-background-clip: text;\n    -webkit-text-fill-color: transparent;\n    display: inline-block;\n}\n\n/* --- УПРАВЛЕНИЕ СЕКЦИЯМИ (Эмуляция страниц) --- */\n.content-section {\n    display: none; /* Скрыто по умолчанию */\n    padding-top: 75px; /* Отступ сверху для хедера */\n    padding-bottom: 15px; /* Отступ снизу */\n    min-height: calc(100vh - 70px);\n    max-width: 600px;\n    margin: 0 auto;\n    width: 100%;\n}\n\n.content-section.active {\n    display: block; /* Отображаем активную секцию */\n}\n\n\n/* --- Верхний Заголовок (Логотип и Название) --- */\n.top-header {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 60px;\n    background-color: var(--card-background);\n    border-bottom: 1px solid var(--border-color);\n    display: flex;\n    align-items: center;\n    padding: 0 15px;\n    z-index: 100;\n    box-shadow: var(--shadow-light);\n}\n\n.logo-link {\n    display: flex;\n    align-items: center;\n    text-decoration: none;\n    cursor: pointer;\n}\n\n.logo-icon {\n    width: 30px;\n    height: 30px;\n    margin-right: 8px;\n}\n\n.logo-text {\n    font-size: 1.5rem;\n    font-weight: 700;\n}\n\n/* --- Главный Статус-Бар (Нижний, Неподвижный) --- */\n.status-bar {\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    width: 100%;\n    height: 70px;\n    background-color: var(--card-background);\n    border-top: 1px solid var(--border-color);\n    display: flex;\n    justify-content: space-around;\n    align-items: center;\n    z-index: 100;\n    box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.05);\n    padding: 0 10px;\n}\n\n.nav-item {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    text-decoration: none;\n    color: #999;\n    font-size: 0.7rem;\n    transition: color 0.3s;\n    flex: 1;\n}\n\n.nav-item.active {\n    color: var(--primary-color);\n}\n\n.nav-icon {\n    font-size: 24px;\n    margin-bottom: 2px;\n}\n\n/* Кнопка ПЛЮС (Больше, Градиент) */\n.add-button {\n    width: 60px;\n    height: 60px;\n    border-radius: 50%;\n    background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));\n    border: none;\n    color: white;\n    font-size: 30px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    cursor: pointer;\n    box-shadow: var(--shadow-heavy);\n    transform: translateY(-15px); /* Поднять над полосой */\n    transition: transform 0.2s;\n}\n\n.add-button.active {\n    /* Если кнопка активна, дадим ей немного иной стиль, например, яркую тень */\n    box-shadow: 0 0 0 4px rgba(255, 87, 34, 0.3), var(--shadow-heavy);\n}\n\n.add-button:active {\n    transform: translateY(-13px) scale(0.98);\n}\n\n.add-icon {\n    color: white !important;\n    -webkit-text-fill-color: white !important;\n}\n\n/* --- Лента Постов (Главная) --- */\n.post-feed {\n    padding: 0 15px;\n}\n\n.post-card {\n    background-color: var(--card-background);\n    border-radius: 12px;\n    padding: 15px;\n    margin-bottom: 20px;\n    box-shadow: var(--shadow-heavy);\n    transition: transform 0.2s, box-shadow 0.2s;\n}\n\n.post-card:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);\n}\n\n.post-title {\n    font-size: 1.25rem;\n    color: var(--primary-color);\n    margin-bottom: 10px;\n}\n\n.post-image {\n    width: 100%;\n    height: auto;\n    max-height: 400px;\n    object-fit: cover;\n    border-radius: 8px;\n    margin-bottom: 10px;\n    background-color: var(--gray-area);\n}\n\n.post-text {\n    font-size: 1rem;\n    line-height: 1.4;\n    color: #555;\n    margin-bottom: 15px;\n}\n\n.no-posts, .loading-message, .no-results {\n    text-align: center;\n    padding: 20px;\n    color: #999;\n}\n\n\n/* --- Действия (Лайк/Дизлайк/Коммент) --- */\n.post-actions {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding-top: 10px;\n    border-top: 1px solid var(--border-color);\n}\n\n.action-button {\n    display: flex;\n    align-items: center;\n    background: none;\n    border: none;\n    color: #666;\n    cursor: pointer;\n    font-size: 0.9rem;\n    transition: color 0.3s;\n    padding: 5px 10px;\n    border-radius: 6px;\n}\n\n.action-button span:first-child {\n    font-size: 20px;\n    margin-right: 5px;\n}\n\n/* Стиль для активных/залитых иконок */\n.like-button.active {\n    color: var(--accent-color);\n}\n.dislike-button.active {\n    color: var(--secondary-color);\n}\n\n/* --- Модальное Окно (Общий стиль) --- */\n.modal {\n    position: fixed;\n    z-index: 200;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    overflow: auto;\n    background-color: rgba(0, 0, 0, 0.6); /* Более темный оверлей для модалок */\n    display: none;\n    justify-content: center;\n    align-items: flex-end; /* Модалки появляются снизу или на весь экран */\n}\n\n.modal-content {\n    background-color: var(--background-light);\n    border-radius: 12px 12px 0 0;\n    width: 100%;\n    max-width: 600px;\n    max-height: 90%;\n    display: flex;\n    flex-direction: column;\n    position: relative;\n    box-shadow: var(--shadow-heavy);\n    animation: slideUp 0.3s ease-out;\n}\n\n@keyframes slideUp {\n    from { transform: translateY(100%); opacity: 0.8; }\n    to { transform: translateY(0); opacity: 1; }\n}\n\n\n.close-button {\n    color: #aaa;\n    font-size: 28px;\n    font-weight: bold;\n    cursor: pointer;\n    line-height: 1;\n}\n\n.close-button:hover,\n.close-button:focus {\n    color: #000;\n}\n\n/* --- Модальное Окно Комментариев --- */\n.comments-content {\n    padding: 20px;\n    height: 70vh; /* Занимает 70% высоты экрана для удобства */\n}\n\n.comments-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    border-bottom: 1px solid var(--border-color);\n    padding-bottom: 10px;\n    margin-bottom: 15px;\n}\n\n.comments-list {\n    flex-grow: 1;\n    overflow-y: auto;\n    padding-right: 10px;\n    margin-bottom: 15px;\n}\n\n.comment-item {\n    background-color: var(--card-background);\n    padding: 10px;\n    border-radius: 8px;\n    margin-bottom: 10px;\n    box-shadow: var(--shadow-light);\n}\n\n.comment-author {\n    font-weight: bold;\n    color: var(--primary-color);\n    margin-right: 5px;\n}\n\n.comment-form {\n    display: flex;\n    gap: 10px;\n    padding-top: 10px;\n    border-top: 1px solid var(--border-color);\n}\n\n.comment-form input {\n    flex-grow: 1;\n    padding: 10px;\n    border: 1px solid var(--border-color);\n    border-radius: 8px;\n}\n\n.comment-form button {\n    background: var(--primary-color);\n    color: white;\n    border: none;\n    padding: 10px 15px;\n    border-radius: 8px;\n    cursor: pointer;\n    transition: background 0.3s;\n}\n\n/* --- Модальное Окно Поиска --- */\n.search-modal {\n    align-items: flex-start; /* Поиск появляется сверху */\n}\n\n.search-content {\n    max-height: 100%;\n    border-radius: 0;\n    animation: slideDown 0.3s ease-out;\n}\n\n@keyframes slideDown {\n    from { transform: translateY(-100%); opacity: 0.8; }\n    to { transform: translateY(0); opacity: 1; }\n}\n\n\n.search-header {\n    display: flex;\n    gap: 10px;\n    align-items: center;\n    padding: 15px;\n    border-bottom: 1px solid var(--border-color);\n    background-color: var(--card-background);\n}\n\n#search-input {\n    flex-grow: 1;\n    padding: 10px;\n    border: 1px solid var(--border-color);\n    border-radius: 20px;\n    font-size: 1rem;\n    outline: none;\n}\n\n.search-results {\n    padding: 15px;\n    overflow-y: auto;\n    max-height: calc(100vh - 70px); \n}\n\n/* --- Страница Создания Поста (Теперь это секция) --- */\n.create-post-container {\n    padding: 15px;\n}\n\n.create-post-container h1 {\n    text-align: center;\n    color: var(--secondary-color);\n    margin-bottom: 25px;\n    font-weight: 600;\n}\n\n.post-form input[type\u003d\"text\"],\n.post-form textarea {\n    width: 100%;\n    padding: 12px;\n    margin-bottom: 15px;\n    border: 1px solid var(--border-color);\n    border-radius: 8px;\n    font-size: 1rem;\n    transition: border-color 0.3s;\n}\n\n.post-form input[type\u003d\"text\"]:focus,\n.post-form textarea:focus,\n#image-url:focus {\n    border-color: var(--primary-color);\n    outline: none;\n}\n\n.image-upload-area {\n    background-color: var(--gray-area);\n    border: 2px dashed #ccc;\n    border-radius: 12px;\n    padding: 20px;\n    text-align: center;\n    margin-bottom: 15px;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n}\n\n.image-icon {\n    font-size: 48px;\n    color: #999;\n}\n\n.image-upload-area p {\n    color: #666;\n    margin-bottom: 10px;\n}\n\n#image-url {\n    background-color: var(--card-background);\n    border-style: solid;\n    padding: 8px;\n}\n\n#publish-button {\n    width: 100%;\n    padding: 15px;\n    background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));\n    color: white;\n    border: none;\n    border-radius: 8px;\n    font-size: 1.1rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: opacity 0.3s;\n    box-shadow: var(--shadow-light);\n}\n\n#publish-button:hover:not(:disabled) {\n    opacity: 0.9;\n}\n\n#publish-button:disabled {\n    background: #ccc;\n    cursor: not-allowed;\n}\n\u003c/style\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\n    \u003cheader class\u003d\"top-header\"\u003e\n        \u003ca href\u003d\"#\" class\u003d\"logo-link\" onclick\u003d\"showMainPage()\"\u003e\n            \u003cimg src\u003d\"https://img.icons8.com/color/48/000000/carpet.png\" alt\u003d\"Логотип ковра\" class\u003d\"logo-icon\"\u003e\n            \u003cspan class\u003d\"logo-text\"\u003eCarpetGram\u003c/span\u003e\n        \u003c/a\u003e\n    \u003c/header\u003e\n\n    \u003cmain class\u003d\"content-section active\" id\u003d\"main-feed-section\"\u003e\n        \u003cdiv class\u003d\"post-feed\" id\u003d\"post-feed-container\"\u003e\n            \u003cdiv class\u003d\"loading-message\" id\u003d\"loading-message\"\u003eЗагрузка постов...\u003c/div\u003e\n        \u003c/div\u003e\n    \u003c/main\u003e\n\n    \u003csection class\u003d\"content-section create-post-container\" id\u003d\"create-post-section\"\u003e\n        \u003ch1\u003eПоделитесь вашим ковром\u003c/h1\u003e\n        \u003cdiv class\u003d\"post-form\"\u003e\n            \u003cinput type\u003d\"text\" id\u003d\"post-title\" placeholder\u003d\"Заголовок поста...\" required\u003e\n\n            \u003cdiv class\u003d\"image-upload-area\" id\u003d\"image-upload-area\"\u003e\n                \u003cspan class\u003d\"material-symbols-outlined image-icon\"\u003ebranding_watermark\u003c/span\u003e\n                \u003cp\u003eПеретащите или вставьте URL изображения ковра\u003c/p\u003e\n                \u003cinput type\u003d\"url\" id\u003d\"image-url\" placeholder\u003d\"URL изображения...\" required\u003e\n            \u003c/div\u003e\n\n            \u003ctextarea id\u003d\"post-text\" placeholder\u003d\"Текст поста о вашем ковре...\" rows\u003d\"6\" required\u003e\u003c/textarea\u003e\n\n            \u003cbutton id\u003d\"publish-button\" onclick\u003d\"publishPost()\"\u003eОпубликовать\u003c/button\u003e\n        \u003c/div\u003e\n    \u003c/section\u003e\n\n    \u003cdiv id\u003d\"comments-modal\" class\u003d\"modal\"\u003e\n        \u003cdiv class\u003d\"modal-content comments-content\"\u003e\n            \u003cdiv class\u003d\"comments-header\"\u003e\n                \u003ch3\u003eКомментарии\u003c/h3\u003e\n                \u003cspan class\u003d\"close-button\" onclick\u003d\"closeCommentsModal()\"\u003e\u0026times;\u003c/span\u003e\n            \u003c/div\u003e\n            \u003cdiv id\u003d\"comments-list\" class\u003d\"comments-list\"\u003e\n                \u003c/div\u003e\n            \u003cdiv class\u003d\"comment-form\"\u003e\n                \u003cinput type\u003d\"text\" id\u003d\"new-comment-text\" placeholder\u003d\"Ваш комментарий...\"\u003e\n                \u003cbutton onclick\u003d\"submitComment()\"\u003eОпубликовать\u003c/button\u003e\n            \u003c/div\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003cdiv id\u003d\"search-modal\" class\u003d\"modal\"\u003e\n        \u003cdiv class\u003d\"modal-content search-content\"\u003e\n            \u003cdiv class\u003d\"search-header\"\u003e\n                \u003cinput type\u003d\"text\" id\u003d\"search-input\" placeholder\u003d\"Поиск по заголовку или тексту поста...\" oninput\u003d\"filterPosts()\"\u003e\n                \u003cspan class\u003d\"close-button\" onclick\u003d\"closeSearchModal()\"\u003e\u0026times;\u003c/span\u003e\n            \u003c/div\u003e\n            \u003cdiv id\u003d\"search-results\" class\u003d\"post-feed search-results\"\u003e\n                \u003c/div\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003cnav class\u003d\"status-bar\"\u003e\n        \u003ca href\u003d\"#\" class\u003d\"nav-item active\" onclick\u003d\"showMainPage()\"\u003e\n            \u003cspan class\u003d\"material-symbols-outlined nav-icon\"\u003ehome\u003c/span\u003e\n            \u003cspan class\u003d\"nav-label\"\u003eГлавная\u003c/span\u003e\n        \u003c/a\u003e\n\n        \u003cbutton class\u003d\"add-button\" onclick\u003d\"showCreatePost()\"\u003e\n            \u003cspan class\u003d\"material-symbols-outlined add-icon\"\u003eadd\u003c/span\u003e\n        \u003c/button\u003e\n\n        \u003ca href\u003d\"#\" class\u003d\"nav-item\" onclick\u003d\"openSearchModal()\"\u003e\n            \u003cspan class\u003d\"material-symbols-outlined nav-icon\"\u003esearch\u003c/span\u003e\n            \u003cspan class\u003d\"nav-label\"\u003eПоиск\u003c/span\u003e\n        \u003c/a\u003e\n    \u003c/nav\u003e\n\n    \u003cscript\u003e\n        // Инициализация Firebase (ВАЖНО: Использовать предоставленный ключ)\n        const firebaseConfig \u003d {\n            apiKey: \"AIzaSyCidNF4Y4KtInPicVuiHpsyM3UtnXfjHuI\",\n            authDomain: \"baseofsos.firebaseapp.com\",\n            databaseURL: \"https://baseofsos-default-rtdb.firebaseio.com\",\n            projectId: \"baseofsos\",\n            storageBucket: \"baseofsos.firebasestorage.app\",\n            messagingSenderId: \"543658307069\",\n            appId: \"1:543658307069:web:6089023d57da67ddeffd94\",\n            measurementId: \"G-X39SMCSECC\"\n        };\n        const app \u003d firebase.initializeApp(firebaseConfig);\n        const database \u003d app.database();\n        const postsRef \u003d database.ref(\u0027posting\u0027);\n\n        let allPostsData \u003d {}; // Хранить все посты для поиска\n\n        // --- Управление секциями (Эмуляция страниц) ---\n        function setActiveSection(sectionId) {\n            // Скрываем все секции, кроме модальных окон (они управляются отдельно)\n            document.querySelectorAll(\u0027.content-section\u0027).forEach(section \u003d\u003e {\n                section.classList.remove(\u0027active\u0027);\n            });\n            // Снимаем активный класс со всех кнопок навигации\n            document.querySelectorAll(\u0027.nav-item\u0027).forEach(item \u003d\u003e {\n                item.classList.remove(\u0027active\u0027);\n            });\n            document.querySelector(\u0027.add-button\u0027).classList.remove(\u0027active\u0027);\n\n            // Показываем нужную секцию\n            document.getElementById(sectionId).classList.add(\u0027active\u0027);\n\n            // Устанавливаем активный класс на кнопку навигации\n            if (sectionId \u003d\u003d\u003d \u0027main-feed-section\u0027) {\n                document.querySelector(\u0027.nav-item:nth-child(1)\u0027).classList.add(\u0027active\u0027);\n            } else if (sectionId \u003d\u003d\u003d \u0027create-post-section\u0027) {\n                document.querySelector(\u0027.add-button\u0027).classList.add(\u0027active\u0027);\n            }\n        }\n\n        function showMainPage() {\n            setActiveSection(\u0027main-feed-section\u0027);\n            closeSearchModal(); // Убедимся, что поиск закрыт\n        }\n\n        function showCreatePost() {\n            setActiveSection(\u0027create-post-section\u0027);\n            closeSearchModal(); // Убедимся, что поиск закрыт\n        }\n        \n        // --- Утилиты для Local Storage (Сохранение действий пользователя) ---\n        const userActions \u003d JSON.parse(localStorage.getItem(\u0027userActions\u0027)) || {};\n\n        function saveUserAction(postId, type) {\n            if (!userActions[postId]) {\n                userActions[postId] \u003d { like: false, dislike: false };\n            }\n            // type: \u0027like\u0027 или \u0027dislike\u0027\n            userActions[postId][type] \u003d !userActions[postId][type]; // Инвертируем текущее состояние\n            localStorage.setItem(\u0027userActions\u0027, JSON.stringify(userActions));\n        }\n\n        function getUserAction(postId, type) {\n            return userActions[postId] \u0026\u0026 userActions[postId][type];\n        }\n\n        // --- Обработчик Лайков/Дизлайков (без изменений) ---\n        function handleLikeDislike(postId, action) {\n            const isLiking \u003d action \u003d\u003d\u003d \u0027like\u0027;\n            const currentState \u003d getUserAction(postId, action);\n            const oppositeAction \u003d isLiking ? \u0027dislike\u0027 : \u0027like\u0027;\n            const oppositeState \u003d getUserAction(postId, oppositeAction);\n\n            let updates \u003d {};\n\n            if (!currentState) {\n                updates[`/${action}s`] \u003d firebase.database.ServerValue.increment(1);\n\n                if (oppositeState) {\n                    updates[`/${oppositeAction}s`] \u003d firebase.database.ServerValue.increment(-1);\n                    saveUserAction(postId, oppositeAction); \n                }\n            } else {\n                updates[`/${action}s`] \u003d firebase.database.ServerValue.increment(-1);\n            }\n\n            saveUserAction(postId, action);\n\n            database.ref(`posting/${postId}`).update(updates).then(() \u003d\u003e {\n                // После изменения данных Firebase автоматически обновит ленту благодаря .on(\u0027value\u0027)\n            }).catch(error \u003d\u003e {\n                console.error(\"Ошибка при обновлении счетчиков:\", error);\n            });\n        }\n\n        // --- Логика Комментариев (Модальное окно) ---\n        let currentPostId \u003d null;\n\n        function openCommentsModal(postId) {\n            currentPostId \u003d postId;\n            document.getElementById(\u0027comments-modal\u0027).style.display \u003d \u0027flex\u0027;\n            loadComments(postId);\n        }\n\n        function closeCommentsModal() {\n            document.getElementById(\u0027comments-modal\u0027).style.display \u003d \u0027none\u0027;\n            currentPostId \u003d null;\n        }\n\n        function loadComments(postId) {\n            const commentsList \u003d document.getElementById(\u0027comments-list\u0027);\n            commentsList.innerHTML \u003d \u0027\u0027;\n            // Используем .off() и .on() для переподключения, если нужно слушать только этот пост\n            database.ref(`posting/${postId}/comments`).off(\u0027value\u0027); \n            database.ref(`posting/${postId}/comments`).on(\u0027value\u0027, (snapshot) \u003d\u003e {\n                commentsList.innerHTML \u003d \u0027\u0027;\n                const comments \u003d snapshot.val();\n                if (comments) {\n                    Object.values(comments).reverse().forEach(comment \u003d\u003e { // Новые сверху\n                        const commentDiv \u003d document.createElement(\u0027div\u0027);\n                        commentDiv.className \u003d \u0027comment-item\u0027;\n                        commentDiv.innerHTML \u003d `\u003cspan class\u003d\"comment-author\"\u003eАноним:\u003c/span\u003e\u003cspan class\u003d\"comment-text\"\u003e${comment.text}\u003c/span\u003e`;\n                        commentsList.appendChild(commentDiv);\n                    });\n                } else {\n                    commentsList.innerHTML \u003d \u0027\u003cdiv class\u003d\"no-comments\"\u003eПока нет комментариев. Будьте первым!\u003c/div\u003e\u0027;\n                }\n            });\n        }\n\n        function submitComment() {\n            const textInput \u003d document.getElementById(\u0027new-comment-text\u0027);\n            const commentText \u003d textInput.value.trim();\n\n            if (commentText \u0026\u0026 currentPostId) {\n                const newCommentRef \u003d database.ref(`posting/${currentPostId}/comments`).push();\n                newCommentRef.set({\n                    text: commentText,\n                    timestamp: Date.now()\n                }).then(() \u003d\u003e {\n                    textInput.value \u003d \u0027\u0027;\n                }).catch(error \u003d\u003e {\n                    console.error(\"Ошибка при добавлении комментария:\", error);\n                });\n            }\n        }\n\n        // --- Логика Поиска (Модальное окно) ---\n        function openSearchModal() {\n            // При открытии поиска, скрываем секции ленты/создания\n            document.getElementById(\u0027main-feed-section\u0027).classList.remove(\u0027active\u0027);\n            document.getElementById(\u0027create-post-section\u0027).classList.remove(\u0027active\u0027);\n            \n            // Снимаем активность с кнопок, кроме поиска\n            document.querySelectorAll(\u0027.nav-item\u0027).forEach(item \u003d\u003e item.classList.remove(\u0027active\u0027));\n            document.querySelector(\u0027.add-button\u0027).classList.remove(\u0027active\u0027);\n            document.querySelector(\u0027.nav-item:nth-child(3)\u0027).classList.add(\u0027active\u0027); // Активируем кнопку поиска\n\n            document.getElementById(\u0027search-modal\u0027).style.display \u003d \u0027flex\u0027;\n            document.getElementById(\u0027search-results\u0027).innerHTML \u003d \u0027\u0027;\n            document.getElementById(\u0027search-input\u0027).value \u003d \u0027\u0027;\n        }\n\n        function closeSearchModal() {\n            document.getElementById(\u0027search-modal\u0027).style.display \u003d \u0027none\u0027;\n            // Возвращаемся к главной странице\n            showMainPage();\n        }\n\n        function filterPosts() {\n            const query \u003d document.getElementById(\u0027search-input\u0027).value.toLowerCase();\n            const resultsContainer \u003d document.getElementById(\u0027search-results\u0027);\n            resultsContainer.innerHTML \u003d \u0027\u0027;\n\n            if (query.length \u003d\u003d\u003d 0) {\n                resultsContainer.innerHTML \u003d \u0027\u003cdiv class\u003d\"no-results\"\u003eНачните вводить текст для поиска.\u003c/div\u003e\u0027;\n                return;\n            }\n\n            const filteredPosts \u003d Object.entries(allPostsData).filter(([id, post]) \u003d\u003e {\n                const titleMatch \u003d post.title.toLowerCase().includes(query);\n                const textMatch \u003d post.text.toLowerCase().includes(query);\n                return titleMatch || textMatch;\n            });\n\n            if (filteredPosts.length \u003e 0) {\n                filteredPosts.forEach(([postId, post]) \u003d\u003e {\n                    resultsContainer.appendChild(createPostElement(postId, post));\n                });\n            } else {\n                resultsContainer.innerHTML \u003d \u0027\u003cdiv class\u003d\"no-results\"\u003eПо вашему запросу ничего не найдено.\u003c/div\u003e\u0027;\n            }\n        }\n\n        // --- Логика Создания Поста ---\n        function publishPost() {\n            const title \u003d document.getElementById(\u0027post-title\u0027).value.trim();\n            const imageUrl \u003d document.getElementById(\u0027image-url\u0027).value.trim();\n            const text \u003d document.getElementById(\u0027post-text\u0027).value.trim();\n            const publishButton \u003d document.getElementById(\u0027publish-button\u0027);\n\n            if (!title || !imageUrl || !text) {\n                alert(\u0027Пожалуйста, заполните все поля.\u0027);\n                return;\n            }\n\n            publishButton.disabled \u003d true;\n            publishButton.innerText \u003d \u0027Публикация...\u0027;\n\n            const newPostRef \u003d postsRef.push();\n            newPostRef.set({\n                title: title,\n                imageUrl: imageUrl,\n                text: text,\n                timestamp: Date.now(),\n                likes: 0,\n                dislikes: 0,\n            }).then(() \u003d\u003e {\n                // Очистка полей\n                document.getElementById(\u0027post-title\u0027).value \u003d \u0027\u0027;\n                document.getElementById(\u0027image-url\u0027).value \u003d \u0027\u0027;\n                document.getElementById(\u0027post-text\u0027).value \u003d \u0027\u0027;\n                \n                publishButton.disabled \u003d false;\n                publishButton.innerText \u003d \u0027Опубликовать\u0027;\n                \n                alert(\u0027Пост успешно опубликован!\u0027);\n                showMainPage(); // Переход на главную страницу после публикации\n            }).catch(error \u003d\u003e {\n                console.error(\"Ошибка при публикации:\", error);\n                alert(\u0027Произошла ошибка при публикации поста.\u0027);\n                publishButton.disabled \u003d false;\n                publishButton.innerText \u003d \u0027Опубликовать\u0027;\n            });\n        }\n\n        // --- Основная Логика Рендеринга Постов (без изменений) ---\n        function createPostElement(postId, post) {\n            const postDiv \u003d document.createElement(\u0027div\u0027);\n            postDiv.className \u003d \u0027post-card\u0027;\n\n            const isLiked \u003d getUserAction(postId, \u0027like\u0027);\n            const isDisliked \u003d getUserAction(postId, \u0027dislike\u0027);\n\n            const likeIconFill \u003d isLiked ? \u0027fill\u0027 : \u0027outlined\u0027;\n            const dislikeIconFill \u003d isDisliked ? \u0027fill\u0027 : \u0027outlined\u0027;\n\n            // Проверка наличия иконки комментария (для поиска)\n            const commentsRef \u003d database.ref(`posting/${postId}/comments`);\n            let commentCount \u003d 0;\n\n            postDiv.innerHTML \u003d `\n                \u003ch2 class\u003d\"post-title\"\u003e${post.title}\u003c/h2\u003e\n                \u003cimg src\u003d\"${post.imageUrl}\" alt\u003d\"${post.title}\" class\u003d\"post-image\"\u003e\n                \u003cp class\u003d\"post-text\"\u003e${post.text}\u003c/p\u003e\n                \u003cdiv class\u003d\"post-actions\"\u003e\n                    \u003cbutton class\u003d\"action-button like-button ${isLiked ? \u0027active\u0027 : \u0027\u0027}\" onclick\u003d\"handleLikeDislike(\u0027${postId}\u0027, \u0027like\u0027)\"\u003e\n                        \u003cspan class\u003d\"material-symbols-${likeIconFill}\"\u003ethumb_up\u003c/span\u003e\n                        \u003cspan\u003e${post.likes || 0}\u003c/span\u003e\n                    \u003c/button\u003e\n                    \u003cbutton class\u003d\"action-button dislike-button ${isDisliked ? \u0027active\u0027 : \u0027\u0027}\" onclick\u003d\"handleLikeDislike(\u0027${postId}\u0027, \u0027dislike\u0027)\"\u003e\n                        \u003cspan class\u003d\"material-symbols-${dislikeIconFill}\"\u003ethumb_down\u003c/span\u003e\n                        \u003cspan\u003e${post.dislikes || 0}\u003c/span\u003e\n                    \u003c/button\u003e\n                    \u003cbutton class\u003d\"action-button comment-button\" onclick\u003d\"openCommentsModal(\u0027${postId}\u0027)\"\u003e\n                        \u003cspan class\u003d\"material-symbols-outlined\"\u003ecomment\u003c/span\u003e\n                        \u003cspan\u003eКомментарии\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n            `;\n            return postDiv;\n        }\n\n        function renderPosts() {\n            const container \u003d document.getElementById(\u0027post-feed-container\u0027);\n            const loadingMessage \u003d document.getElementById(\u0027loading-message\u0027);\n            loadingMessage.style.display \u003d \u0027block\u0027;\n            container.innerHTML \u003d \u0027\u0027; \n\n            // Используем .on(\u0027value\u0027) для постоянной синхронизации ленты\n            postsRef.on(\u0027value\u0027, (snapshot) \u003d\u003e {\n                container.innerHTML \u003d \u0027\u0027;\n                loadingMessage.style.display \u003d \u0027none\u0027;\n\n                const posts \u003d snapshot.val();\n\n                if (posts) {\n                    allPostsData \u003d posts; \n\n                    // Отображаем посты в обратном порядке (самые новые сверху)\n                    Object.keys(posts).reverse().forEach(postId \u003d\u003e {\n                        const post \u003d posts[postId];\n                        container.appendChild(createPostElement(postId, post));\n                    });\n                } else {\n                    container.innerHTML \u003d \u0027\u003cp class\u003d\"no-posts\"\u003eПока нет ни одного ковра. Будьте первым!\u003c/p\u003e\u0027;\n                }\n            }, (error) \u003d\u003e {\n                console.error(\"Ошибка Firebase:\", error);\n                loadingMessage.innerText \u003d \u0027Ошибка загрузки данных.\u0027;\n            });\n        }\n\n        // Запуск при старте\n        document.addEventListener(\u0027DOMContentLoaded\u0027, () \u003d\u003e {\n            renderPosts();\n            showMainPage(); // Убедимся, что открыта главная страница\n        });\n\n    \u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e"]